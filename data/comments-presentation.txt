http://indiewebcamp.com/comments-presentation

= Comments Presentation =
Expansion of a section of the page on [[comment]] [[posts]] on how to display received comments.

How comments are presented, should be, and who is doing what.

== How to ==
=== How to display ===
Goal: display received comments in high fidelity, at least as nicely designed as the comments that are "natively" displayed on blog posts and [[silo]] posts (e.g. replies on [[Twitter]] posts, comments on [[Facebook]] posts, [[Flickr]]/[[Instagram]] photos, etc. - see [[#Silos|Silos]] below for analysis of their practices).

Per [[comment#Accept_a_comment|Accept a comment]], your system should already be:
* Listening for [[webmention]] on your server (have your server software support it)

And when your server receives a webmention URL:
* parse the '''[[h-entry]]''' at that URL (only use the first h-entry if there's more than one, seriously, it's supposed to be a permalink) - use a [[microformats2]] parser to do so.
* if its hyperlink to the original post lacks [[in-reply-to]] markup, then add it to the "Related Articles" or "Mentions" section in the [[posts#Footer_sections|post footer]], otherwise keep going:
* '''get commenter information to display'''
** if the h-entry has a '''p-author''', use its '''h-card''':
** otherwise get the first[[#first-rel-author|*]] '''rel-author''' link on the page, retrieve the URL it points to, and use its representative '''h-card''':
*** '''logo/photo'''
*** '''name'''
*** '''url''' (of commenter profile/homepage)
* '''get the text of the comment to display'''
** IF the h-entry has an '''e-content''', AND if the text is not too long (per your own site UI preference/design, but note that "too long" may be both by character/word count or by number of lines if the content contains newlines), THEN use that, after [[sanitize|sanitizing]] (filtering out unsafe HTML).
** IF there is no '''e-content''' OR it's too long, THEN
*** IF the h-entry has a '''p-summary''', AND the text is not too long, THEN use that (useful author crafted summary or for longer posts where only a part of it is the comment)
**** IF the '''p-summary''' is too long (per your own site UI preference/design), THEN truncate the '''p-summary''' yourself (per below TRUNCATING details)
*** ELSE truncate the '''e-content''' (if any) yourself (per TRUNCATING).
** OTHERWISE (no '''e-content''' and no '''p-summary'''), IF it has a '''p-name''', THEN use that
*** IF the '''p-name''' is too long (per your own site UI preference/design)
*** THEN truncate the '''p-name''' yourself (per TRUNCATING).
** TRUNCATING: IF the text of the comment (however you got it above) is too long (your site, your judgment), THEN abbreviate it with some intelligent ellipsing code (e.g. see [[Twitter#POSSE_abbr_note_to_twitter|POSSEing an abbreviated note to Twitter]] for some thinking) and provide a "See more" / "View more" / "More ..." link to the permalink (useful to have an explicit link to the whole comment right next to the ellipsis when YOU (your site) has chosen to truncate or show only a summary because comments can themselves have an ellipsis at the end).
* '''get more comment info to display'''
** use the h-entry '''dt-published''' for the time of the reply
*** additionally, its '''dt-updated''' could be used for an "edited: datetime" annotation in your display
** use its '''u-url''' for the permalink (hyperlink the time of reply to the permalink)
* '''optional location brainstorm''' - because not many have implemented location info in posted replies
** use the h-entry '''p-geo''' / p-latitude / p-longitude for location - you may need to use a service to translate that into a human readable neighborhood / city / state / country name. perhaps hyperlink to a map, or an aggregation on your site of all posts (and comments) near that location.
*** (Issue: perhaps [[h-entry]] could use a [[p-location]] property similar to [[h-event]] that would permit embedding of an [[h-adr]] with structured address information.)

With that information a sufficiently rich display should be possible in a "Comments" section in the footer on the original post permalink. Add to that for each comment:
* [[webaction]] like/favorite/props button/link
And you've hopefully got a comment display of similar fidelity to anything the [[silos]] have.

Note: some of this has been implemented!
* [[Storytlr]] receives comment posts via [[pingback]], then parses the post content and author information from the [[h-entry]] and [[h-card]] on the page, and then displays:
** author of comment from h-card / name, photo, url properties
** contents of comment post from h-entry / content, published, url properties
** e.g.: http://eschnou.com/entry/testing-indieweb-federation-with-waterpigscouk-aaronpareckicom-and--62-24908.html
* ... what implementation will be next?

Issues:
* '''<span id="first-rel-author">"*first" rel-author</span>''' is good enough because a) there aren't many multiauthor blogs, comparatively speaking, and more importantly b) this is retrieving a *reply* post, and those are always written by a single person, so there should only be a single rel-author on *that* page. Real-world counter-examples welcome.

==== in realtime ====
Even better, if you can display comments in '''[[real-time]]''' on people viewing a post, when they're received by your server, it looks amazing to the user. Idea/challenge [[events/2013-09-30-indieweb-dinner#Realtime_inline_display_of_comments|2013-09-30]].

How to overview:
* keep a websocket open from the browser view of your post with comments to your server
* have your server push comments to your browser view your post through the open websocket.
See also: [http://aaronparecki.com/articles/2013/10/13/1/realtime-indieweb-comments detailed how to, sample code, demo video]

===== IndieWeb Implementations =====
====== Aaron Parecki ======
[[User:Aaronparecki.com|Aaron Parecki]] has supported real-time display of received comments on his posts on [http://Aaronparecki.com aaronparecki.com] using [[p3k]] since [http://aaronparecki.com/articles/2013/10/13/1/realtime-indieweb-comments 2013-10-13].

=== How to markup ===

The post the comments are in reply to should be a top-level h-entry, and comments on it should be marked up as h-cites nested under the comment property. For example:

<pre><nowiki>
<div class="h-entry">
 <h1 class="p-name">The Main Entry</h1>
 <p class="p-author h-card">John Smith</p>
 <p class="e-content">A few insights I've had:</p>
 
 <h2>Comments</h2>
 
 <div class="u-comment h-cite">
  <a class="u-author h-card" href="http://jane.example.com/">Jane Bloggs</a>
  <p class="p-content p-name">Ha ha ha great article John.</p>
  <a class="u-url" href="http://jane.example.com/c12">
    <time class="dt-published">2015-07-12 HH:MM</time>
  </a>
 </div>

 <div class="u-comment h-cite">
  <a class="u-author h-card" href="http://kim.example.net">Kim Codes</a>
  <p class="p-content p-name">What were the insights?</p>
  <a class="u-url" href="http://kim.example.net/k23">
    <time class="dt-published">2015-07-12 HH:MM</time>
  </a>
 </div>
 • 
 •
 •
</div>
</nowiki></pre>


What each of these do:
* '''u-comment''' - identifies the element as a comment on the h-entry, for comment discovery when reading an [[h-entry]] for [[salmention]] receiving.
* u-comment '''h-cite''' - identifies the comment as a citation of an actual comment likely copied from somewhere else, for providing a hint for comment discovery to crawl further for an original.
** The '''u-''' prefix on the "comment" property works to get the u-url from inside the h-cite
* '''u-author''' - URL to the comment author's site
* u-author '''h-card''' - h-card to structure the author's URL and name into a single structure
* '''p-content''' - complete text content of the comment
* p-content '''p-name''' - use the text of the comment as a label for the comment if necessary in a compact list presentation
* '''u-url''' - permalink of the comment, necessary for [[salmention]] receivers to uniquely identify individual comments
* '''dt-published''' - when the comment was published, provides a text label for linking to the permalink

See also: 
* http://microformats.org/wiki/comment-brainstorming#microformats2_p-comment_h-entry
Which documents a bunch of pre-indieweb thinking of how to markup comments, especially when comments were only made natively on a post directly, rather than being propagated peer-to-peer.

In general this "how to" and the indieweb approach is a further simplification of the microformats comment-brainstorming, with properties added as needed by real world needs.

==== p-content on comment body ====
Note that class="p-content" is used for the body of the comment, here's why:
# '''p-* instead of e-*''': The easiest and safest thing to do is to only show plain text comment content from someone else's site. Therefore use p-content instead of e-content. If you were including links, images, or anything else richer than plain text from someone else's site, then you could use e-content.
# '''p-content instead of p-summary''': Typical comments are small enough to display in their entirety, thus that common case is the entirety of the content not a summary, therefore p-content is more appropriate than p-summary. If for some reason you find it necessary to truncate the comment (or use someone else's "p-summary"), then yes, you should use p-summary instead of p-content.

==== Issues ====

* I think the h-cite markup only works for comments via pingback/webmention, but what about comments made directly on the post using a comment-form? -- [[User:Notizblog.org|pfefferle]]
** Native comments make sense as "h-entry" since the copy of them on the post is likely the canonical copy. - [[User:Tantek.com|Tantek]] 13:45, 12 July 2015 (PDT)

=== How to delete ===
{{main|deleted#Handling}}
How to delete comments received from other sites.

If an indie web [[reply]]/comment post is [[deleted]], that user's site is expected to send another webmention accordingly.

If when attempting to retrieve the reply permalink URL your server receives a 410 GONE, then your server is expected to delete the existing syndicated copy of that comment.

See [[deleted#Handling|handling deleted posts]] for details.

== IndieWeb Examples ==
Automatically:
=== Laurent Eschenauer ===
'''[[User:Eschnou.com|Laurent Eschenauer]] using [[Storytlr]]''': displays comment posts from the IndieWeb marked up with [[h-entry]] and received via [[pingback]], and comments posted locally on his posts, in an integrated time-ordered "Comments" section, e.g.:
* http://eschnou.com/entry/testing-indieweb-federation-with-waterpigscouk-aaronpareckicom-and--62-24908.html
=== Aaron Parecki ===
'''{{aaronpk}} using [[p3k]]'''
* http://aaronparecki.com/notes/2013/05/21/1/xkcd
=== Sandeep Shetty ===
'''[[User:Sandeep.io|Sandeep Shetty]]''' using '''[[Projects#Converspace|Converspace]]'''
* http://www.sandeep.io/64
=== Barnaby Walters ===
'''{{barnabywalters}}''' using [[Taproot]] and marking up using .p-comment.h-entry ([http://waterpigs.co.uk/notes/4QgMZN/ example])
=== Ben Werdmuller ===
'''{{benwerd}}''' using [[idno]] ([http://werd.io/view/51d5097fbed7ded0633a5956#comments example])
=== gRegor Morrill ===
'''{{gregorlove}}''' using [[Nucleus|Nucleus CMS]]
* http://gregorlove.com/2014/01/1178/
* Displaying a consolidated list of local blog comments with webmentions, in chronological order.
* Displaying likes/favorites as meta information if a comment is received from the same person. See the [[User:Gregorlove.com/webmention#Relating_webmentions_together|implementation notes]] for more information.

=== Ryan Barrett ===
{{snarfed}} using [[WordPress]] e.g.
* https://snarfed.org/2015-06-04_what-doesnt-kill-my-baby
Uses:
* <code>p-comment</code> on each embedded comment

=== Pelle Wessman ===
{{voxpelli}} using [http://webmention.herokuapp.com/ webmention.herokuapp.com] and <code>u-responses</code> to link to an external <code>h-feed</code> with a list of all received comments. Example:

* http://voxpelli.com/2013/12/webmentions-for-static-pages/

=== Manually Display ===
E.g. List of links in a [[posts#Footer_sections|post footer]] section:
==== Tom Morris ====
{{tommorris}} sometimes adds links+favicons to a “this post is discussed further at” section ([http://tommorris.org/posts/2506 recent example]).

==== Tantek ====
{{t}} sometimes maintains a citation list of posts which link to one of his posts, e.g. 
* http://tantek.com/2013/073/b1/silos-vs-open-social-web#silos-vs-open-social-web-comments
And more recently is experimenting with manually incorporating indieweb [[reply]] posts into a comments section:
* http://tantek.com/2015/190/b1/blinking-fever#blinking-fever-comments

==== Kartik Prabhu ====
{{kartik}} sometimes manually adds comments/replies to his comments on other sites that don't support webmention:
* https://kartikprabhu.com/notes/re-metric-clifford-signs2#response-replies

=== Past Practices ===
* [[User:tantek.com|Tantek]] used to maintain lists of links to his posts of people’s names linked to comment permalinks:
** 2002: [http://tantek.com/log/2002/12.html#L20021216t2238 inline list with flags to represent comment languages]
** 2003: [http://tantek.com/log/2003/12.html#L20031215t0830 inline list with some text annotations].
** 2005: [http://tantek.com/log/2005/10.html#d02t1813 block list with follow-ups to comments]

== Silos ==
In general existing blog/silo posts display comments (in either chronological or reverse chronological order) with the following details:
* '''commenter logo/photo'''
* '''commenter name'''
** '''hyperlinked to commenter profile'''
* '''full text''' of comment
* '''time''' of comment
** often in relative time since rather than absolute datetime
*** though see reasons why [http://aaronparecki.com/articles/2012/08/23/1/you-should-not-be-displaying-relative-dates you should not be displaying relative dates]
** '''hyperlinked to comment permalink'''
* '''commenter location''' (variable granularity) at time of comment writing
** '''hyperlinked''' to silo aggregation of activity at that location
* '''like/favorite button''' (to like or favorite the comment/@-reply)

=== Tumblr ===
[[Tumblr]] groups various different response types into a generic “notes” feed, at the bottom of each post ([http://www.kungfugrippe.com/post/47159818629/something-something-syncing#notes example]). They show:
* The author’s username
* The author’s profile photo
=== Twitter ===
[[Twitter]] shows all tweets which are both in-reply-to a particular tweet AND contain the original tweeters @name below the tweet metadata in chronological order. They provide a “reply” box above (?) the reply feed ([https://twitter.com/wilto/status/322028394944532480 example]). The tweets have:
* The authors name
* The author’s @name
* The author’s profile photo
* A relative timestamp
* The tweet content
* A bunch of actions (on hover)
=== Facebook ===
[[Facebook]] treats comments as completely secondary to “full” posts, showing them in chronological order beneath the post’s action bar. Facebook only show the latest ~4 comments if there are more, and display the leave-a-comment box below. They have:
* The author’s name
* The author’s profile photo
* The comment content
* A relative timestamp
* 'via mobile' if applicable
* Like button w/ like counter
[[File:facebook-post-with-responses.png]]

=== Comment Hiding ===
[https://stevenf.com/shutupcss/ shutup.css] is custom stylesheet that hides comments on many popular websites. As such it is empirical research on how silos mark up comments. See [http://stevenf.com/shutup/shutup-latest.css the CSS] for details.

== Existing specifications for display ==
Included here for thoroughness / historical purposes - a critique of existing specifications for display.

Summary: Existing specifications either don't say much or provide bad advice for what to display (if anything) in response to receiving a webmention.

=== Trackback display ===
{{main|Trackback}}
The [http://movabletype.org/documentation/trackback/specification.html TrackBack Specification] (and [http://en.wikipedia.org/wiki/Trackback Trackback Wikipedia page]) doesn't appear to have any explicit implementation guidance for how to display trackback pings that have been received.

In practice however, many CMS's display trackbacks in a section explicitly labeled "Trackbacks:", and for each such trackback ping:
* title of the post that sent the trackback
* ellipsed [...] ... [...] summary text, which is nearly unreadable without more context, and doesn't even show what phrase linked to the original blog post if any.
* the overall visual design is very dated and has fallen behind modern comment presentation designs

=== Pingback display ===
{{main|pingback#Poor_display}}

See [[pingback#Poor_display|Pingback: Poor display]] for detail on how the specification itself provides very poor advice on display.

Pingback display practices appear to have been mostly based on Trackback display practices. Unfortunately, in practice Pingback displays are nearly always useless, e.g.
* https://blog.mozilla.org/blog/2013/04/10/gearing-up-for-the-next-chapter/

Problems demonstrated:
* "Pingback from" is jargon - provides no value to the user - only noise
* the title of the comment blog post is useless as it provides a summary of the original blog post
* the [...] ... [...] summary text is nearly unreadable without more context, and doesn't even show what phrase linked to the original blog post
** in the first pingback, even just including the entire first paragraph of the comment post would have been better. And if it wasn't a reply then it should just be a list of related articles (date, author, linked post name, all marked up with [[h-cite]]), rather than including cryptic broken summaries.
* the overall visual design is very dated and has fallen behind modern comment presentation designs

== FAQ ==
=== Why use p-summary when I can truncate e-content ===
''Q: I guess if I grab the e-content and think it's too long, I might as well just truncate it myself. why would I need the p-summary?''

A: Because the p-summary is likely (or even just possibly) explicitly crafted by the author/publishers to be a more meaningfully truncated version of the e-content than you could yourself automatically truncate.

=== Why use u-comment instead of p-comment ===
'''Q:''' Why use <code>u-comment</code> around the comment instead of <code>p-comment</code>?

'''A:''' <code>u-comment</code> will parse the comment's implied value as the comment's URL, which is useful for [[salmention]] support. [http://indiewebcamp.com/irc/2015-07-22#t1437612361069]

== Discussion ==
* Long posts where only a part of it is in-reply-to another post and a large chuck of it is a tangent should not be published as a reply/comment and instead should be published as a mention. Noting this here because this is accounted for above in the "How to display > get the text of the comment to display" section and it might wrongly send the message that (largely tangential) posts like these should be marked up with in-reply-to. (See [http://indiewebcamp.com/irc/2013-07-07/line/1373241638])
* https://the-pastry-box-project.net/marie-connelly/2014-june-24
* For places where comments can't be included in line the use of a <code>u-responses</code> to point to another page containing a list of <code>h-entry</code> objects with all of the received comments would be useful. Useful in blog lists and when using an external WebMention endpoint such as [http://webmention.herokuapp.com/ webmention.herokuapp.com] [[User:Kodfabrik.se|Kodfabrik.se]]

== See Also ==
* [[comment]]
* [[webmention]]
* [[h-entry]]
* [[h-card]]
