https://indieweb.org/Shortcuts

{{stub}}

'''<dfn>Shortcuts</dfn>''' is an iOS app formerly known as Workflow used to automate various actions. With the advanced "Get contents of URL" action it can be used to make [[Micropub]] requests or upload files to a [[media endpoint]].

== Instagram POSSE ==

{{Sebsel}} uses Shortcuts to post photo's to his site, and then POSSE them to his [[Instagram]].

His shortcut is as follows. Note that most of the bulletpoints, once set, run automatically. You need to [[obtaining-an-access-token|obtain an Access Token]] to your Micropub Endpoint, or steal one from a Micropub client you already use.

In the native Photos app, choose a picture to post, then open the share menu and run the following Shortcut:

A Shortcut called 'Foto op Seblog' which accepts images:
* Set variable {photo} (I will use this bracket notation for vars here)
* Ask for input: caption?
* Copy to clipboard (so you can add it to Instagram later)
* Set variable {caption}
* URL (point this one to your Micropub endpoint)
* Get contents of URL > advanced
** Method: POST
** Headers: Authorization: bearer [token] (put your token here)
** Request body: (Form)
*** h: entry (just that text)
*** photo: {photo} (this one as 'file', select the variable)
*** content: {content} (select the variable)
* Get URLs from Input - this is a tricky one. I let my Micropub endpoint return a body with '<code><nowiki><a href="new-post-url">Success</a></nowiki></code>' in order for this to work
* Open URLs (now you're redirected to Safari, opening your new post manually go back to the Photos app now, then Shortcut starts again)
* Choose from menu: 'Also post on Instagram?' > Yes > Cancel
** on yes:
*** Get variable {photo}
*** Post on Instagram (I have caption set to var Content, but that doesn't seem to work always)

Then, on Instagram, just click through the menu's. When asked for the caption, if it's not there, you can just paste from your clipboard, the caption should be there.

After posting copy the URL of the Instagram-post to your clipboard.

Go back to Safari, where your new post is still lurking, open Share menu and choose the following shortcut 'Save syndication', which takes URLs and Safari web pages:

* Get URLs from Input
* Set variable {entryurl}
* Ask for input: What is the Instagram url? > default answer {clipboard} > input type URL (you can leave this step out and just grab the clipboard, but I like checking)
* Set variable {insta}
* URL (set this to be your Micropub endpoint)
* Get contents of URL > Advanced
** Method: POST
** Headers: Authorization: bearer [token] (put your token here)
** Request body: (JSON!)
*** action: update
*** url: {entryurl}
*** (as dictionary) add:
**** (as array) syndication:
***** {insta}
* Get var {entryurl}
* Open URLs
And there you have it!

== IndieAuth flow ==

{{sebsel}} made a Shortcut that does the IndieAuth dance for you, in order to pick up a token. It can be embedded into Micropub workflows, as it returns the token.

The current version required one weird copy-paste step, because iOS is not able to parse attributes after a redirect to the Shortcut app.

You can [https://www.icloud.com/shortcuts/6b70abc373ae4a03add1f9fd8c862e2d download the Shortcut here].

== Micropub Media Endpoint ==

=== Pre-Built Shortcut ===
You can download a pre-built Shortcut that allows you to upload files to your media endpoint using the Share Sheet, or if the Shortcut is activated outside the share sheet it will present an option to upload from your Photos library or from the Files app.

You can [https://www.icloud.com/shortcuts/794029f98c944ce68c82f7df47cf93f7 download the Shortcut here]

=== Creating Your Own Custom Shortcut ===
[[File:media-endpoint-workflow-settings.png|right|200px]]
[[File:media-endpoint-workflow-details.png|right|200px]]

Create a new shortcut

* Accepts: Images, Media
* What type of shortcut? Action Extension

add the following items:

* '''URL''': Set the URL to your media endpoint
* '''Get Contents of URL''': Advanced
** Method: POST
** Headers: <code>Authorization: Bearer XXXX</code> (insert a Micropub access token)
** Request Body: Form
*** file: Shortcut magic variable, choose "Shortcut Input"
* '''Show Notification''': Contents of URL (This will display the response from your media endpoint so you can confirm the upload worked)

{{clear}}

== See Also ==
* [https://workflow.is/workflows/ef78462689e94ca7be794540e08b8e05 Template for the Photo to Micropub and Instagram shortcut]
* [https://workflow.is/workflows/ef3138adb4764c9a8e1e6de6fe389593 Template for the Save Syndication shortcut]
* https://workflow.is
