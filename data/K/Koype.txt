https://indieweb.org/Koype

'''<dfn>Koype</dfn>''' is an open-source [[project]] that aims to provide a one-stop shop for those looking for a single-tenant Web service to [[own-your-data]].

The project is currently still underway and an example of the single tenant site is available at [https://v2.jacky.wtf v2.jacky.wtf]. The source code is at [https://git.jacky.wtf/indieweb/koype/ git.jacky.wtf]. See [https://koype.net https://koype.net] for more information about the project.

== Initial Launch ==
For its first release (v0.1.0), Koype aims to have the following features:

* ✓ [[IndieAuth|self-hosted authentication via IndieAuth]]
* ✓ [[Micropub|self-hosted posts management via Micropub]]
* ✓ [[Webmentions|self-hosted web mention support via Webmentions]]
* a dedicated page for [[following|simplifying the act of following page]]
* abstracted object storage support
* ✓ emit [[nodeinfo]] information
* ✓ support for a [[nickname-cache|nickname cache]]

= Features =
Koype aims to ship with loads of IndieWeb specific features as well as some other protocols and standards that allow other platforms to interact with it. Despite having everything in it, it'll allow for external configuration pointing to allow for [[plurality]] of the [[building blocks]] used by Koype.

== Salmention Support ==
Status: Not Working On Yet

[[Salmentions]] provide a solid approach to show responses to responses made on one's site. Koype doesn't support this yet. A method for storing this would be keeping a 'separate' table for salmentions and point them to the associated webmention that was originially received. That way, we can nest them in the correct way for the theming system to handle. 

== Private Posts ==
Status: [https://git.jacky.wtf/indieweb/koype/issues/169 '''working on''']

[[private_posts|Private posts]] are intended to allow people to visit a instance of Koype and view content addressed to them. This would also involve sending [[webmention|WebMentions]] to sites that are addressed in the post as well.

=== Address List ===
An address list in Koype is an extension of the [[Koype#Address_Book|address book]] feature. People are represented using [[h-card]]s and can be put into multiple address lists. The HTML representation of said list would look something like this:

<pre>
<main class="h-feed">
  <h1 class="p-name">The New Avengers</h1>
  <p class="p-note">These are people I can trust to avenge us; whatever it takes.</p>
  <a class="h-card u-url" href="https://shield.mil/agents/black-widow">Natasha Romonov</a>
  <a class="h-card u-url" href="https://sword.mil/agents/marvel">Carol Danvers</a>
  <a class="h-card u-url" href="https://stark.com/staff/walters-jennifer">Jennifer Walters</a>
  <a class="h-card u-url" href="https://tony.stark">Anthony Edward Stark</a>
  <a class="h-card u-url" href="https://avengers.org/staff/rogers-steve">Stephen Rogers</a>
</main>
</pre>

The additional MF2 added to a post that'd be only visible to the site's owner (and those that the owner decided to use would be something like the following:

<pre>
<p>
  This post is viewable only to <a class="u-x-addressed-to" href="https://avengers.org/teams/new">The New Avengers</a>.
</p>
</pre>

With a post with the above markup held behind a page protected with [[AutoAuth]], when Koype requests authorization, only members of the address list above would be permitted to view said post.

=== Implementation Path ===
The route for implementation would be something like the following:

* Require that a user has been authenticated to the site (using [[IndieAuth]] or [[AutoAuth]])
** If not, give <code>401</code>
** If so, go back to the page in question with elevated permissions.

The next part is interesting because it can be something that works across ranges. Things I'd want:

* client understanding of the expiry of access
* authorization to view post to be relatively fast (implementation-specific)

== Webmention Sending and Receiving ==
Status: [https://git.jacky.wtf/indieweb/koype/issues/6|'''working on''']

Koype provides an internal system for processing and handling [[webmention|WebMentions]]. There's a dashboard to view incoming webmentions.

=== Sub Features ===

* Add listing/record of outgoing webmentions - currently visible on jobs page
* Searching by:
** source (incoming) domains
** source post types ([[reply]], [[like]] etc)
* Blocking by
** source domains (regex)
** source types (regex)
* Permitting a fixed list of types to be shown
* [[Private-Webmention|Private Webmentions]]

=== Code Generation for Private Webmentions ===
By default, Koype would generate a random code per recipient and associate it with the post. This way, only the intended recipient would be able to use the code. Providing an interface to edit said code can help with personalization.

=== Configuration ===
Following in the spirit of [[Micropub]], I want to extend Koype to have some functionality that allow for remote adjustments of this endpoint. This is largely to enable "one click" support for [[Lighthouse]] into Koype instances. Upon requesting the <code>webmention</code> scope from Koype when executing [[IndieAuth]], the field <code>webmention_configuration_endpoint</code> is provided as one of the result fields. It'll allow for you to query against it for things like 

* currently exposed Webmention endpoint
* the status callback URL to use (see [[Webmention#Asynchronous_status_notification]]

The flow for setting up a hosted Webmention client would be the following:

* Sign into service using IndieAuth with the [[scopes]] <code>webmention</code> and <code>update</code>
* Take the configuration endpoint and call the change command on it.

This flow is similar for setting up the async status URL as well.

==== Updating Asynchronous Callback URL ====
<pre>
POST /endpoints/webmention-configuration

q=async-callback
action=update
url=$NEW_CALLBACK_URL

200 OK
</pre>

'''Notes'''
* Should this field just be <code>callback</code> to match what's conventionally expected when sending async Webmentions?

==== Setting new Webmention Endpoint ====
<pre>
POST /endpoints/webmention-configuration

q=endpoint
action=update
url=$NEW_WEBMENTION_ENDPOINT

200 OK
</pre>

==== Getting [[Vouch]] values ====
<pre>
POST /endpoints/webmention-configuration

q=vouch

200 OK

{
  "vouch": [
    "https://indieweb.org/chat-names",
    "https://public-vouch-engine.org",
  ]
}
</pre>

==== Adding [[Vouch]] values ====
<pre>
POST /endpoints/webmention-configuration

q=vouch
action=add
url=$VOUCH_URL

200 OK
</pre>

== IndieAuth Provider ==
Status: [https://git.jacky.wtf/indieweb/koype/issues/1|'shipped' (baseline)], [https://git.jacky.wtf/indieweb/koype/issues/31|'backlog' (alt)]

Koype provides an in-built [[IndieAuth]] system for authenticating the site against remote services. It also provides support for swapping out the in-built system for a third-party service like [[IndieLogin]] or [[Fortress]].

== Address Book ==
Status: '''in progress'''

Koype allows for one to store [[h-card]] information about people in a lightweight fashion using [[Micropub]]. For ease of use, immediately searchable attributes are stored to the database. Everything else is stored to longer term storage (the object storage system). This makes it easy to look up people in the future and mention them when appropriate.

[[File:Koype-NicknameCache.png|200px|right|Preview of the listing of the internal cache]]

=== Sub Features ===

* Add contacts ([[h-card]]) information to groups ([[category]])

== Post Type ==
Koype has support for the following post types:

* [[h-entry]]
** [[note]]
** [[like]]
** [[reply]]
** [[repost]]
** [[bookmark]]
** [[photo]]
** [[video]]
** [[rsvp]]

=== Planned Post Types ===
The following are post types that are on the list of things to support but aren't being actively worked on as of yet.

* [[h-event]]
* [[h-review]]
* [[h-card]]

=== Toggling of Post Types ===
Koype has the ability to enable or disable specific post types. When a post type is 'disabled', it's rendered as a note.

[[File:Screenshot 20200222 202241 1.png]]

== Remote Subscription ==
Koype implements a form of [[rel-subscribe]] that:

* allows people to pre-configure a subscription to a feed type (or use the preferred one)
* allows Koype to handle incoming guided subscription requests to the preferred [[Microsub#Clients|Microsub client]] of choice.

The *act* of subscribing is done entirely by the [[Microsub#Clients|Microsub client]] that the user specifies.

= Progress Log =
== 2018.10 ==
* 03: [[IndieAuth]] support has implemented with 100% coverage. Will fail aggressively if client application does not emit h-x-app or h-app information.

[[File:Koype-0.0.1-indieauth-confirmation.png]]

* 10: Baseline [[Micropub]] support is underway. Plans on how storage of entries is still lightly in the air.

* 11: Implemented logic for persisting [[Micropub]] data in the form of [[h-entry]] JSON.

* 17: Implemented [[post-type-discovery]] and light [[jf2]] support.

* 26: Post-type detection is provided.

[[File:Screenshot_20181026_185007.png]]

* 27: Automatic sign-in support for applications under the user's choosing.

== 2018.11 ==
* 05: Added more styling for [[note]], [[photo]] and [[article]] posts.
  [[File:Screen_Shot_2018-11-05_at_21.12.17-fullpage.png]]
* 28: [[dogfooding]] has begun: https://v2.jacky.wtf/entry/8f8433dc-3433-4542-a3ea-7acbf0edba60
* 30: Solidified design of posts
  [[File:Screen_Shot_2018-11-30_at_15.29.28-fullpage.png|600px]]

= Screenshots =
These are screen captures from the test suite taken on January 15, 2019.
* Login page<br>[[File:Koype 0.0.1-Auth-Sign-In.png|480px]]
* Setup page
** Authentication<br>[[File:Koype 0.0.1-Setup-Auth.png|480px]]
** Profile<br>[[File:Koype 0.0.1-Setup-Profile.png|480px]]
* Settings page
** representative [[h-card]] info<br>[[File:Koype 0.0.1-Settings-Hcard.png|480px]]
** [[webmention]]
*** (none) <br>[[File:Koype 0.0.1-Settings-Webmention=Empty.png|480px]]
*** (a few) <br>[[File:Koype 0.0.1-Settings-Webmention=List.png|480px]]
** verified links // [[rel-me]]
*** (none) <br>[[File:Koype 0.0.1-Settings-RelMe=Empty.png|480px]]
*** (a few) <br>[[File:Koype 0.0.1-Settings-RelMe=List.png|480px]]

= See Also =

* [https://github.com/keithjgrant/omnibear/issues/79 #79 Add h-x-app information]
* [[Koype Hub]]
* https://git.jacky.wtf/indieweb/koype/releases
* [[Koype/Publish]]

[[Category:CMS]]
